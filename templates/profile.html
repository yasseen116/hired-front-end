{% extends "_base.html" %}

{% block title %}My Profile - Hired{% endblock %}

{% block content %}
<div class="page" id="app">
    <div class="container" style="margin-top: 40px; margin-bottom: 60px;">

        <div v-if="loading" class="loading-state">
            <div class="spinner-border text-primary" role="status"></div>
            <p>Loading profile...</p>
        </div>

        <div v-else class="profile-layout">

            <aside class="profile-sidebar">
                <div class="content-card user-card">
                    <div class="member-avatar">
                        <img :src="user.photo || '../static/images/img-placeholder.png'" alt="User Avatar">
                    </div>
                    <h2 class="user-name">[[ user.name ]]</h2>
                    <p class="user-title">[[ user.jobTitle ]]</p>
                    <p class="user-email">[[ user.email ]]</p>

                    <hr class="divider">

                    <div class="sidebar-stats">
                        <div class="stat">
                            <strong>[[ applications.length ]]</strong>
                            <span>Applied</span>
                        </div>
                        <div class="stat">
                            <strong>[[ user.skills.length ]]</strong>
                            <span>Skills</span>
                        </div>
                    </div>
                </div>
            </aside>

            <main class="profile-content">

                <form @submit.prevent="saveProfile" class="profile-form">

                    <div class="content-card">
                        <h3 class="card-header">Personal Information</h3>

                        <div class="form-row">
                            <div class="form-group half">
                                <label>Full Name</label>
                                <input type="text" v-model="user.name" placeholder="John Doe" required>
                            </div>
                            <div class="form-group half">
                                <label>Job Title</label>
                                <input type="text" v-model="user.jobTitle" placeholder="e.g. Software Engineer" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group half">
                                <label>Phone Number</label>
                                <input type="text" v-model="user.phone" placeholder="+20 1xx xxxx xxx">
                            </div>
                            <div class="form-group half">
                                <label>Location</label>
                                <input type="text" v-model="user.location" placeholder="Cairo, Egypt">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>About Me</label>
                            <textarea v-model="user.about" rows="4" placeholder="Briefly describe your professional background..."></textarea>
                        </div>
                    </div>

                    <div class="content-card">
                        <h3 class="card-header">Skills</h3>
                        <div class="form-group" style="position: relative;">
                            <transition-group name="skill-list" tag="div">
                                <div v-for="(skill, index) in user.skills" :key="skill.id" class="skill-row">
                                    <input type="text" v-model="skill.value" placeholder="e.g. Python" required>

                                    <button v-if="user.skills.length > 1" type="button" class="btn-icon btn-remove-skill" @click="removeSkill(index)">&times;</button>
                                    <button v-if="index === user.skills.length - 1" type="button" class="btn-icon btn-add" @click="addSkill">+</button>
                                </div>
                            </transition-group>
                            <button v-if="user.skills.length === 0" type="button" class="btn btn-card-details" @click="addSkill">Add Skill</button>
                        </div>
                    </div>

                    <div class="profile-content-card">
                        <h3 class="card-header">Work Experience</h3>
                        <div class="form-group" style="position: relative;">

                            <transition-group name="skill-list" tag="div">
                                <div v-for="(exp, index) in user.experience" :key="exp.id" class="skill-row">
                                    <input type="text" v-model="exp.role" placeholder="Role (e.g. Dev)" required>
                                    <input type="text" v-model="exp.company" placeholder="Company" required>
                                    <input type="text" v-model="exp.years" placeholder="Years (e.g. 2022)" style="max-width: 120px;" required>

                                    <button v-if="user.experience.length > 0" type="button" class="btn-icon btn-remove-skill" @click="removeExperience(index)">&times;</button>
                                    <button v-if="index === user.experience.length - 1" type="button" class="btn-icon btn-add" @click="addExperience">+</button>
                                </div>
                            </transition-group>

                            <button v-if="user.experience.length === 0" type="button" class="btn btn-card-details" @click="addExperience">
                                + Add Work Experience
                            </button>
                        </div>
                    </div>

                    <div class="profile-content-card">
                        <h3 class="card-header">Education</h3>
                        <div class="form-group" style="position: relative;">

                            <transition-group name="skill-list" tag="div">
                                <div v-for="(edu, index) in user.education" :key="edu.id" class="skill-row">
                                    <input type="text" v-model="edu.degree" placeholder="Degree" required>
                                    <input type="text" v-model="edu.university" placeholder="University" required>
                                    <input type="text" v-model="edu.year" placeholder="Year" style="max-width: 120px;" required>

                                    <button v-if="user.education.length > 0" type="button" class="btn-icon btn-remove-skill" @click="removeEducation(index)">&times;</button>
                                    <button v-if="index === user.education.length - 1" type="button" class="btn-icon btn-add" @click="addEducation">+</button>
                                </div>
                            </transition-group>

                            <button v-if="user.education.length === 0" type="button" class="btn btn-card-details" @click="addEducation">
                                + Add Education
                            </button>
                        </div>
                    </div>

                    <div class="profile-content-card">
                        <h3 class="card-header">Resume / CV</h3>

                        <div v-if="user.cvName" class="cv-preview-box">
                            <div class="cv-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                            </div>
                            <div class="cv-info">
                                <span class="cv-name">[[ user.cvName ]]</span>
                                <span class="cv-label">Current Resume</span>
                            </div>
                            <div class="cv-actions">
                                <label for="replaceCv" style="cursor: pointer; margin-right: 10px; color: #0a66c2; font-weight: 600; padding-top: 6px;">Replace</label>
                                <input type="file" id="replaceCv" @change="handleFileUpload" style="display: none;" accept=".pdf,.doc,.docx">

                                <button type="button" class="btn-icon btn-preview" style="width: 35px; height: 35px; margin-right: 5px;" @click="previewCv" title="Preview Resume">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                                </button>

                                <button type="button" class="btn-icon btn-remove-skill" style="width: 35px; height: 35px;" @click="removeCv" title="Remove Resume">&times;</button>
                            </div>
                        </div>

                        <div v-else class="form-group">
                            <input type="file" id="cv" @change="handleFileUpload" accept=".pdf,.doc,.docx" style="display: none;">
                            <label for="cv" class="custom-file-upload">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                                <span>Upload your Resume</span>
                            </label>
                        </div>
                    </div>

                    <div style="text-align: right; margin-bottom: 40px;">
                        <button type="submit" class="btn btn-apply-large" :disabled="isSaving">
                            [[ isSaving ? 'Saving Changes...' : 'Save Profile' ]]
                        </button>
                    </div>

                </form>

                <div class="profile-content-card">
                    <h3 class="card-header">Applied Jobs</h3>

                    <div v-if="applications.length === 0" style="color: #666; font-style: italic; padding: 10px;">
                        You haven't applied to any jobs yet.
                    </div>

                    <div v-else class="applications-list">
                        <div class="app-item" v-for="app in applications" :key="app.id">
                            <div class="app-info">
                                <h4 class="app-job-title">[[ app.jobTitle ]]</h4>
                                <span class="app-date">Applied on: [[ app.appliedAt ]]</span>
                            </div>
                            <div class="app-status">
                                <span class="status-badge" :class="getStatusClass(app.status)">
                                    [[ app.status ]]
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="../static/js/model.js"></script>
<script src="../static/js/profile.js"></script>
{% endblock %}